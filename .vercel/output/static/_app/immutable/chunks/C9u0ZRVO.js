import{w as s,g as c}from"./F1DUsJPN.js";const u=globalThis.__sveltekit_cnkncu.env,d="https://api.dijitalmentor.de/server/api",m=(u.PUBLIC_API_URL||d).replace(/\/$/,"");function g(){const{subscribe:i,set:a}=s({user:null,token:null,isAuthenticated:!1,loading:!0});return{subscribe:i,checkAuth:async()=>{const t=localStorage.getItem("dijitalmentor_token"),o=localStorage.getItem("dijitalmentor_user"),n=o?JSON.parse(o):null,r=e=>{localStorage.setItem("dijitalmentor_token",t),localStorage.setItem("dijitalmentor_user",JSON.stringify(e)),a({user:e,token:t,isAuthenticated:!0,loading:!1})};if(!t){a({user:null,token:null,isAuthenticated:!1,loading:!1});return}try{const e=await fetch(`${m}/auth/me.php`,{headers:{Authorization:`Bearer ${t}`}}),l=await e.json();if(e.ok&&(l!=null&&l.data)){r(l.data);return}}catch(e){console.warn("Auth sync failed",e)}if(n){r(n);return}localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1})},login:(t,o)=>{localStorage.setItem("dijitalmentor_token",o),localStorage.setItem("dijitalmentor_user",JSON.stringify(t)),a({user:t,token:o,isAuthenticated:!0,loading:!1})},logout:()=>{localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1}),c("/")}}}const f=g();export{f as a,u as e};
