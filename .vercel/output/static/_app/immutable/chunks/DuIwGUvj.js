import{g as s}from"./AYnVVvoY.js";import{w as c}from"./bOQqAygr.js";const u=globalThis.__sveltekit_1s78ng9.env,m="https://api.dijitalmentor.de/server/api",d=(u.PUBLIC_API_URL||m).replace(/\/$/,"");function g(){const{subscribe:i,set:a}=c({user:null,token:null,isAuthenticated:!1,loading:!0});return{subscribe:i,checkAuth:async()=>{const t=localStorage.getItem("dijitalmentor_token"),o=localStorage.getItem("dijitalmentor_user"),n=o?JSON.parse(o):null,r=e=>{localStorage.setItem("dijitalmentor_token",t),localStorage.setItem("dijitalmentor_user",JSON.stringify(e)),a({user:e,token:t,isAuthenticated:!0,loading:!1})};if(!t){a({user:null,token:null,isAuthenticated:!1,loading:!1});return}try{const e=await fetch(`${d}/auth/me.php`,{headers:{Authorization:`Bearer ${t}`}}),l=await e.json();if(e.ok&&(l!=null&&l.data)){r(l.data);return}}catch(e){console.warn("Auth sync failed",e)}if(n){r(n);return}localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1})},login:(t,o)=>{localStorage.setItem("dijitalmentor_token",o),localStorage.setItem("dijitalmentor_user",JSON.stringify(t)),a({user:t,token:o,isAuthenticated:!0,loading:!1})},logout:()=>{localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1}),s("/")}}}const _=g();export{_ as a,u as e};
