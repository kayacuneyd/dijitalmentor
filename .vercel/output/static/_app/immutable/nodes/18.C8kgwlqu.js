import{f as h,a as b,c as Re}from"../chunks/DRQhfDIo.js";import"../chunks/DBxwTJFr.js";import{c as et,o as it}from"../chunks/BEILL-FU.js";import{p as Ye,m as f,K as W,g as e,h as B,X as x,b as u,M as qe,s as o,c as a,t as O,B as ot,v as d,r,C as nt,a as Qe,f as Ae,e as dt,$ as lt}from"../chunks/xs6IHYAp.js";import{s as y}from"../chunks/2kSiabv9.js";import{e as Ee,i as Je}from"../chunks/C8azlFkc.js";import{i as I}from"../chunks/DR5YvfYR.js";import{h as ct}from"../chunks/Dca_OwJL.js";import{r as Oe,b as ut,s as vt}from"../chunks/0sRNiewY.js";import{s as he}from"../chunks/BjvWVg2m.js";import{e as P}from"../chunks/BUEFyR2Q.js";import{b as ye}from"../chunks/C5zhuI-4.js";import{p as bt}from"../chunks/CWmzcjye.js";import{i as We}from"../chunks/CtUxkv_u.js";import{a as Xe,s as tt}from"../chunks/BqzXtDWn.js";import{a as rt}from"../chunks/DuIwGUvj.js";import{a as be}from"../chunks/DOijXAo_.js";import{g as gt}from"../chunks/AYnVVvoY.js";import{p as mt}from"../chunks/Cl66-DY3.js";import{p as Ke}from"../chunks/CnwI_PJQ.js";import{t as M}from"../chunks/CagCIhxo.js";var ft=h("<option>Dersler yÃ¼kleniyor...</option>"),pt=h("<option> </option>"),_t=h('<div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-address">Adres</label> <input id="agreement-address" type="text" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm" placeholder="Adres veya dernek bilgisi"/></div>'),xt=h('<div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm space-y-4"><div class="flex items-center justify-between"><div><h3 class="text-base font-semibold text-gray-900">Onay Formu OluÅŸtur</h3> <p class="text-sm text-gray-500">Ders detaylarÄ±nÄ± belirleyip Jitsi linki oluÅŸturun.</p></div> <span class="px-3 py-1 rounded-full bg-blue-50 text-blue-700 text-xs font-semibold">Jitsi</span></div> <div class="grid md:grid-cols-2 gap-3"><div><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-subject">Ders</label> <select id="agreement-subject" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm"><!></select></div> <div><p class="block text-sm font-medium text-gray-700 mb-1">Lokasyon</p> <div class="grid grid-cols-3 gap-2"><button type="button">Ã–ÄŸrenci evi</button> <button type="button">Dernek</button> <button type="button">Online</button></div></div> <!> <div><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-rate">Saatlik Ãœcret (â‚¬)</label> <input id="agreement-rate" type="number" min="0" step="0.5" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-hours">HaftalÄ±k Saat</label> <input id="agreement-hours" type="number" min="1" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-start">BaÅŸlangÄ±Ã§ Tarihi</label> <input id="agreement-start" type="date" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm"/></div> <div class="md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-1" for="agreement-notes">Notlar</label> <textarea id="agreement-notes" rows="3" class="w-full border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 text-sm" placeholder="Ã–rn: Haftada 2 saat online matematik..."></textarea></div></div> <div class="flex justify-end gap-2"><button type="button" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition disabled:opacity-50"> </button></div></div>');function yt(Ce,Z){var _e,oe;Ye(Z,!1);const T=f();let Ne=Ke(Z,"conversationId",8),He=Ke(Z,"recipientId",8),S=Ke(Z,"subjects",24,()=>[]);const we=et();let g=f(!1),t=f({subject_id:((oe=(_e=S())==null?void 0:_e[0])==null?void 0:oe.id)||"",lesson_location:"online",lesson_address:"",hourly_rate:25,hours_per_week:1,start_date:"",notes:""});async function G(){var m,D;if(!e(g)){if(!S().length){M.error("Ders listesi yÃ¼klenemedi");return}if(!e(t).subject_id||!e(t).hourly_rate){M.error("Ders ve Ã¼cret alanlarÄ± zorunludur");return}if(!e(T)&&!e(t).lesson_address.trim()){M.error("Fiziksel dersler iÃ§in adres girin");return}u(g,!0);try{const A={conversation_id:Ne(),recipient_id:He(),subject_id:Number(e(t).subject_id),lesson_location:e(t).lesson_location,hourly_rate:Number(e(t).hourly_rate),hours_per_week:Number(e(t).hours_per_week)||1,start_date:e(t).start_date||null,notes:((m=e(t).notes)==null?void 0:m.trim())||null,lesson_address:((D=e(t).lesson_address)==null?void 0:D.trim())||null,meeting_platform:"jitsi"},n=await be.post("/agreements/create.php",A);M.success(n.message||"Onay formu gÃ¶nderildi"),we("success",n.data)}catch(A){console.error(A),M.error(A.message||"Onay formu oluÅŸturulamadÄ±")}finally{u(g,!1)}}}W(()=>(x(S()),e(t)),()=>{S().length&&!e(t).subject_id&&B(t,e(t).subject_id=S()[0].id)}),W(()=>e(t),()=>{u(T,e(t).lesson_location==="online")}),qe(),We();var z=xt(),ee=o(a(z),2),s=a(ee),R=o(a(s),2);O(()=>{e(t),ot(()=>{S()})});var C=a(R);{var H=m=>{var D=ft();D.value=D.__value="",b(m,D)},V=m=>{var D=Re(),A=Ae(D);Ee(A,1,S,Je,(n,l)=>{var v=pt(),p=a(v);r(v);var xe={};O(()=>{y(p,`${e(l),d(()=>e(l).icon)??""} ${e(l),d(()=>e(l).name)??""}`),xe!==(xe=(e(l),d(()=>e(l).id)))&&(v.value=(v.__value=(e(l),d(()=>e(l).id)))??"")}),b(n,v)}),b(m,D)};I(C,m=>{x(S()),d(()=>S().length===0)?m(H):m(V,!1)})}r(R),r(s);var N=o(s,2),ge=o(a(N),2),E=a(ge),te=o(E,2),re=o(te,2);r(ge),r(N);var me=o(N,2);{var X=m=>{var D=_t(),A=o(a(D),2);Oe(A),r(D),ye(A,()=>e(t).lesson_address,n=>B(t,e(t).lesson_address=n)),b(m,D)};I(me,m=>{e(T)||m(X)})}var ae=o(me,2),fe=o(a(ae),2);Oe(fe),r(ae);var ke=o(ae,2),pe=o(a(ke),2);Oe(pe),r(ke);var je=o(ke,2),se=o(a(je),2);Oe(se),r(je);var $e=o(je,2),ie=o(a($e),2);nt(ie),r($e),r(ee);var Se=o(ee,2),Y=a(Se),Fe=a(Y,!0);r(Y),r(Se),r(z),O(()=>{he(E,1,(e(t),d(()=>`border rounded-lg px-3 py-2 text-sm ${e(t).lesson_location==="student_home"?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-200 text-gray-700"}`))),he(te,1,(e(t),d(()=>`border rounded-lg px-3 py-2 text-sm ${e(t).lesson_location==="turkish_center"?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-200 text-gray-700"}`))),he(re,1,`border rounded-lg px-3 py-2 text-sm ${e(T)?"border-blue-500 text-blue-700 bg-blue-50":"border-gray-200 text-gray-700"}`),Y.disabled=(e(g),x(S()),d(()=>e(g)||S().length===0)),y(Fe,e(g)?"GÃ¶nderiliyor...":"Onay Formu GÃ¶nder")}),ut(R,()=>e(t).subject_id,m=>B(t,e(t).subject_id=m)),P("click",E,()=>B(t,e(t).lesson_location="student_home")),P("click",te,()=>B(t,e(t).lesson_location="turkish_center")),P("click",re,()=>B(t,e(t).lesson_location="online")),ye(fe,()=>e(t).hourly_rate,m=>B(t,e(t).hourly_rate=m)),ye(pe,()=>e(t).hours_per_week,m=>B(t,e(t).hours_per_week=m)),ye(se,()=>e(t).start_date,m=>B(t,e(t).start_date=m)),ye(ie,()=>e(t).notes,m=>B(t,e(t).notes=m)),P("click",Y,G),b(Ce,z),Qe()}var ht=h('<div class="text-sm text-gray-700"><span class="font-semibold">Adres:</span> </div>'),wt=h('<div class="text-sm text-gray-700"><span class="font-semibold">Not:</span> </div>'),kt=h('<div class="flex items-center justify-between gap-3 bg-blue-50 border border-blue-100 rounded-lg px-3 py-2"><div class="text-sm text-blue-800 font-semibold">Jitsi Linki hazÄ±r</div> <a class="text-sm font-semibold text-blue-700 underline" target="_blank" rel="noreferrer">Dersi baÅŸlat</a></div>'),jt=h('<button class="px-3 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition disabled:opacity-50">Kabul Et</button> <button class="px-3 py-2 bg-red-600 text-white rounded-lg text-sm font-semibold hover:bg-red-700 transition disabled:opacity-50">Reddet</button>',1),$t=h('<button class="px-3 py-2 bg-gray-100 text-gray-800 rounded-lg text-sm font-semibold hover:bg-gray-200 transition disabled:opacity-50">Ä°ptal Et</button>'),St=h('<div class="border-t border-dashed border-gray-200 pt-3 space-y-2"><div class="text-sm font-semibold text-gray-900">Ders Saati Kaydet (Ã–dÃ¼l takibi)</div> <div class="grid md:grid-cols-3 gap-2"><input type="number" min="0.5" step="0.5" placeholder="Saat" class="border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500"/> <input type="text" placeholder="Not (opsiyonel)" class="border-gray-200 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 md:col-span-2"/></div> <div class="flex justify-end"><button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-semibold hover:bg-blue-700 transition disabled:opacity-50"> </button></div></div>'),Dt=h('<div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm space-y-3"><div class="flex items-start justify-between gap-3"><div><div class="text-sm text-gray-500 flex items-center gap-2"><span class="text-lg"> </span> <span class="font-semibold text-gray-900"> </span> <span class="text-gray-400">â€¢</span> <span> </span></div> <div class="text-xs text-gray-500 mt-1"> </div></div> <span> </span></div> <div class="grid md:grid-cols-3 gap-3 text-sm text-gray-700"><div class="p-3 bg-gray-50 rounded-lg border border-gray-100"><div class="text-xs text-gray-500">Ãœcret</div> <div class="font-semibold"> </div></div> <div class="p-3 bg-gray-50 rounded-lg border border-gray-100"><div class="text-xs text-gray-500">HaftalÄ±k</div> <div class="font-semibold"> </div></div> <div class="p-3 bg-gray-50 rounded-lg border border-gray-100"><div class="text-xs text-gray-500">BaÅŸlangÄ±Ã§</div> <div class="font-semibold"> </div></div></div> <!> <!> <!> <div class="flex flex-wrap gap-2"><!> <!></div> <!></div>');function It(Ce,Z){Ye(Z,!1);const T=()=>Xe(rt,"$authStore",Ne),[Ne,He]=tt(),S=f(),we=f(),g=f(),t=f(),G=f(),z=f(),ee=f();let s=Ke(Z,"agreement",8);const R=et();let C=f(!1),H=f(!1),V=f(""),N=f("");const ge={student_home:"Ã–ÄŸrenci evi",turkish_center:"Dernek",online:"Online"};async function E(i){if(!e(C)){u(C,!0);try{await be.post("/agreements/respond.php",{agreement_id:s().id,status:i}),M.success(i==="accepted"?"OnaylandÄ±":i==="rejected"?"Reddedildi":"Ä°ptal edildi"),R("responded",{id:s().id,status:i})}catch(c){console.error(c),M.error(c.message||"Ä°ÅŸlem baÅŸarÄ±sÄ±z")}finally{u(C,!1)}}}async function te(){var c,$,L,ce;if(e(H))return;const i=parseFloat(e(V));if(!i||i<=0){M.error("GeÃ§erli bir saat deÄŸeri girin");return}u(H,!0);try{const w=await be.post("/rewards/track_hours.php",{agreement_id:s().id,hours_completed:i,notes:((c=e(N))==null?void 0:c.trim())||null});u(V,""),u(N,"");const k=(L=($=w.data)==null?void 0:$.new_rewards)!=null&&L.length?` ğŸ‰ ${w.data.new_rewards.length} Ã¶dÃ¼l kazandÄ±nÄ±z`:"";M.success(`Saat kaydedildi. Toplam: ${((ce=w.data)==null?void 0:ce.total_hours)||i} saat.${k}`),R("hoursLogged",w.data)}catch(w){console.error(w),M.error(w.message||"Saat kaydedilemedi")}finally{u(H,!1)}}W(()=>T(),()=>{u(S,T().user)}),W(()=>(e(S),x(s())),()=>{var i,c;u(we,((i=e(S))==null?void 0:i.id)===((c=s())==null?void 0:c.sender_id))}),W(()=>(e(S),x(s())),()=>{var i,c;u(g,((i=e(S))==null?void 0:i.id)===((c=s())==null?void 0:c.recipient_id))}),W(()=>(x(s()),e(g)),()=>{var i;u(t,((i=s())==null?void 0:i.status)==="pending"&&e(g))}),W(()=>(x(s()),e(g),e(we)),()=>{var i;u(G,((i=s())==null?void 0:i.status)==="pending"&&(e(g)||e(we)))}),W(()=>x(s()),()=>{var i;u(z,((i=s())==null?void 0:i.subject_icon)||"ğŸ“˜")}),W(()=>x(s()),()=>{var i;u(ee,((i=s())==null?void 0:i.subject_name)||"Ders")}),qe(),We();var re=Dt(),me=a(re),X=a(me),ae=a(X),fe=a(ae),ke=a(fe,!0);r(fe);var pe=o(fe,2),je=a(pe,!0);r(pe);var se=o(pe,4),$e=a(se,!0);r(se),r(ae);var ie=o(ae,2),Se=a(ie);r(ie),r(X);var Y=o(X,2),Fe=a(Y,!0);r(Y),r(me);var _e=o(me,2),oe=a(_e),m=o(a(oe),2),D=a(m);r(m),r(oe);var A=o(oe,2),n=o(a(A),2),l=a(n);r(n),r(A);var v=o(A,2),p=o(a(v),2),xe=a(p,!0);r(p),r(v),r(_e);var F=o(_e,2);{var q=i=>{var c=ht(),$=o(a(c));r(c),O(()=>y($,` ${x(s()),d(()=>s().lesson_address)??""}`)),b(i,c)};I(F,i=>{x(s()),d(()=>s().lesson_address&&s().lesson_location!=="online")&&i(q)})}var Le=o(F,2);{var Me=i=>{var c=wt(),$=o(a(c));r(c),O(()=>y($,` ${x(s()),d(()=>s().notes)??""}`)),b(i,c)};I(Le,i=>{x(s()),d(()=>s().notes)&&i(Me)})}var _=o(Le,2);{var J=i=>{var c=kt(),$=o(a(c),2);r(c),O(()=>vt($,"href",(x(s()),d(()=>s().meeting_link)))),b(i,c)};I(_,i=>{x(s()),d(()=>s().meeting_link)&&i(J)})}var ne=o(_,2),Te=a(ne);{var De=i=>{var c=jt(),$=Ae(c),L=o($,2);O(()=>{$.disabled=e(C),L.disabled=e(C)}),P("click",$,()=>E("accepted")),P("click",L,()=>E("rejected")),b(i,c)};I(Te,i=>{e(t)&&i(De)})}var de=o(Te,2);{var le=i=>{var c=$t();O(()=>c.disabled=e(C)),P("click",c,()=>E("cancelled")),b(i,c)};I(de,i=>{e(G)&&i(le)})}r(ne);var Ie=o(ne,2);{var Be=i=>{var c=St(),$=o(a(c),2),L=a($);Oe(L);var ce=o(L,2);Oe(ce),r($);var w=o($,2),k=a(w),ue=a(k,!0);r(k),r(w),r(c),O(()=>{k.disabled=e(H),y(ue,e(H)?"Kaydediliyor...":"Saat Ekle")}),ye(L,()=>e(V),ze=>u(V,ze)),ye(ce,()=>e(N),ze=>u(N,ze)),P("click",k,te),b(i,c)};I(Ie,i=>{x(s()),d(()=>s().status==="accepted")&&i(Be)})}r(re),O(()=>{y(ke,e(z)),y(je,e(ee)),y($e,(x(s()),d(()=>ge[s().lesson_location]||s().lesson_location))),y(Se,`GÃ¶nderen: ${x(s()),d(()=>s().sender_name)??""} Â· AlÄ±cÄ±: ${x(s()),d(()=>s().recipient_name)??""}`),he(Y,1,(x(s()),d(()=>`px-3 py-1 rounded-full text-xs font-semibold ${s().status==="accepted"?"bg-green-50 text-green-700 border border-green-100":s().status==="pending"?"bg-yellow-50 text-yellow-700 border border-yellow-100":"bg-gray-100 text-gray-600 border border-gray-200"}`))),y(Fe,(x(s()),d(()=>s().status))),y(D,`â‚¬${x(s()),d(()=>s().hourly_rate)??""} / saat`),y(l,`${x(s()),d(()=>s().hours_per_week)??""} saat`),y(xe,(x(s()),d(()=>s().start_date||"Belirtilmedi")))}),b(Ce,re),Qe(),He()}var zt=h('<div class="p-4 text-center text-gray-500">YÃ¼kleniyor...</div>'),At=h('<div class="p-4 text-center text-gray-500">HenÃ¼z mesajÄ±nÄ±z yok.</div>'),Ot=h('<span class="text-xs text-gray-400 whitespace-nowrap ml-2"> </span>'),Ht=h('<div class="bg-blue-600 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center flex-shrink-0"> </div>'),Lt=h('<button><div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg"> </div> <div class="flex-1 min-w-0"><div class="flex justify-between items-baseline mb-1"><h3 class="font-semibold text-gray-900 truncate"> </h3> <!></div> <p> </p></div> <!></button>'),Mt=h('<div class="flex items-center justify-center h-full text-gray-400"><p>HenÃ¼z mesaj yok. Ä°lk mesajÄ± gÃ¶nderin!</p></div>'),Tt=h('<div><div><p> </p> <div class="text-xs mt-1 opacity-70 text-right"> </div></div></div>'),Ct=h('<div class="text-sm text-gray-500">Onay formlarÄ± yÃ¼kleniyor...</div>'),Nt=h('<div class="text-sm text-gray-500">HenÃ¼z onay formu yok.</div>'),Ft=h('<div class="grid gap-3"></div>'),Bt=h('<div class="p-4 bg-white border-b border-gray-100 flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold"> </div> <div><h3 class="font-bold text-gray-900"> </h3> <span class="text-xs text-gray-500"> </span></div></div> <div id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4"><!></div> <div class="bg-white border-t border-gray-100 px-4 py-3 space-y-3"><div class="flex items-center justify-between"><div><h4 class="text-sm font-semibold text-gray-900">Onay FormlarÄ±</h4> <p class="text-xs text-gray-500">Ders detaylarÄ± ve Jitsi linkleri</p></div> <button class="px-3 py-1.5 text-sm font-semibold rounded-lg border border-blue-200 text-blue-700 bg-blue-50 hover:bg-blue-100 transition"> </button></div> <!> <!></div> <div class="p-4 bg-white border-t border-gray-100"><form class="flex gap-2"><input type="text" placeholder="Bir mesaj yazÄ±n..." class="flex-1 border border-gray-200 rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition"/> <button type="submit" class="bg-blue-600 text-white px-6 rounded-xl font-semibold hover:bg-blue-700 transition disabled:opacity-50">GÃ¶nder</button></form></div>',1),Gt=h('<div class="flex-1 flex items-center justify-center text-gray-400 flex-col gap-4"><div class="text-6xl">ğŸ’¬</div> <p>MesajlaÅŸmaya baÅŸlamak iÃ§in bir sohbet seÃ§in.</p></div>'),Rt=h('<div class="container mx-auto px-4 py-8 h-[calc(100vh-4rem)]"><div class="bg-white rounded-2xl shadow-sm border border-gray-100 h-full flex overflow-hidden"><div class="w-full md:w-80 border-r border-gray-100 flex flex-col"><div class="p-4 border-b border-gray-100"><h2 class="text-xl font-bold text-gray-900">Mesajlar</h2></div> <div class="flex-1 overflow-y-auto"><!></div></div> <div class="flex-1 flex flex-col bg-gray-50/30 hidden md:flex"><!></div></div></div>');function lr(Ce,Z){Ye(Z,!1);const T=()=>Xe(rt,"$authStore",He),Ne=()=>Xe(mt,"$page",He),[He,S]=tt(),we=f();let g=f([]),t=f(null),G=f([]),z=f(""),ee=f(!0),s=f(!1),R=f([]),C=f(!1),H=f(!1),V=f([]),N=!1,ge;it(async()=>{var l;if(!T().isAuthenticated){gt("/giris");return}await E();const n=Ne().url.searchParams.get("teacher_id");if(n){const v=parseInt(n);((l=T().user)==null?void 0:l.role)==="student"?M.error("Ã–ÄŸretmenler diÄŸer Ã¶ÄŸretmenlerle mesajlaÅŸamaz"):await ae(v)}else e(g).length>0&&te(e(g)[0]);return me(),ge=setInterval(()=>{e(t)&&(re(e(t).id,!0),X(e(t).id,!0)),E()},3e4),()=>{ge&&clearInterval(ge)}});async function E(){try{const n=await be.get("/messages/list.php");u(g,n.data)}catch(n){console.error(n)}finally{u(ee,!1)}}async function te(n){u(t,n),await re(n.id),await X(n.id)}async function re(n,l=!1){try{const v=await be.get(`/messages/detail.php?conversation_id=${n}`);u(G,v.data.messages.reverse()),setTimeout(()=>{const p=document.getElementById("chat-container");p&&(p.scrollTop=p.scrollHeight)},0)}catch(v){l||console.error(v)}}async function me(){if(!(N||e(V).length)){N=!0;try{const n=await be.get("/subjects/list.php");u(V,n.data||[])}catch(n){console.error(n)}finally{N=!1}}}async function X(n,l=!1){if(n){u(C,!0);try{const v=await be.get(`/agreements/list.php?conversation_id=${n}`);u(R,v.data||[])}catch(v){l||(console.error(v),M.error("Onay formlarÄ± yÃ¼klenemedi"))}finally{u(C,!1)}}}async function ae(n){try{const l=await be.post("/messages/start.php",{other_user_id:n});await E();const v=e(g).find(p=>p.id===l.data.conversation_id);v&&te(v)}catch(l){console.error(l),alert("MesajlaÅŸma baÅŸlatÄ±lamadÄ±. LÃ¼tfen tekrar deneyin.")}}async function fe(){if(!e(z).trim()||!e(t))return;u(s,!0);const n=e(z);u(z,"");try{const l=await be.post("/messages/send.php",{conversation_id:e(t).id,message_text:n});u(G,[...e(G),l.data]);const v=e(g).findIndex(p=>p.id===e(t).id);if(v!==-1){B(g,e(g)[v].last_message=l.data.message_text),B(g,e(g)[v].last_message_at=l.data.created_at);const p=e(g).splice(v,1)[0];u(g,[p,...e(g)])}setTimeout(()=>{const p=document.getElementById("chat-container");p&&(p.scrollTop=p.scrollHeight)},0)}catch(l){console.error(l),u(z,n),alert("Mesaj gÃ¶nderilemedi. LÃ¼tfen tekrar deneyin.")}finally{u(s,!1)}}function ke(){u(H,!1),e(t)&&X(e(t).id)}function pe(){e(t)&&X(e(t).id)}function je(n){var v;const l=((v=n.detail)==null?void 0:v.new_rewards)||[];l.length&&M.success(`Tebrikler! ${l.length} yeni Ã¶dÃ¼l aÃ§Ä±ldÄ±.`)}W(()=>T(),()=>{u(we,T().user)}),qe(),We();var se=Rt();ct("psk39h",n=>{dt(()=>{lt.title="Mesajlar - DijitalMentor"})});var $e=a(se),ie=a($e),Se=o(a(ie),2),Y=a(Se);{var Fe=n=>{var l=zt();b(n,l)},_e=n=>{var l=Re(),v=Ae(l);{var p=F=>{var q=At();b(F,q)},xe=F=>{var q=Re(),Le=Ae(q);Ee(Le,1,()=>e(g),Je,(Me,_)=>{var J=Lt(),ne=a(J),Te=a(ne,!0);r(ne);var De=o(ne,2),de=a(De),le=a(de),Ie=a(le,!0);r(le);var Be=o(le,2);{var i=w=>{var k=Ot(),ue=a(k,!0);r(k),O(ze=>y(ue,ze),[()=>(e(_),d(()=>new Date(e(_).last_message_at).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})))]),b(w,k)};I(Be,w=>{e(_),d(()=>e(_).last_message_at)&&w(i)})}r(de);var c=o(de,2),$=a(c,!0);r(c),r(De);var L=o(De,2);{var ce=w=>{var k=Ht(),ue=a(k,!0);r(k),O(()=>y(ue,(e(_),d(()=>e(_).unread_count)))),b(w,k)};I(L,w=>{e(_),d(()=>e(_).unread_count>0)&&w(ce)})}r(J),O(w=>{he(J,1,`w-full p-4 flex items-start gap-3 hover:bg-gray-50 transition text-left border-b border-gray-50 last:border-0 ${e(t),e(_),d(()=>{var k;return((k=e(t))==null?void 0:k.id)===e(_).id?"bg-blue-50/50":""})??""}`),y(Te,w),y(Ie,(e(_),d(()=>e(_).other_user.name))),he(c,1,`text-sm text-gray-500 truncate ${e(_),d(()=>e(_).unread_count>0?"font-semibold text-gray-900":"")??""}`),y($,(e(_),d(()=>e(_).last_message||"HenÃ¼z mesaj yok")))},[()=>(e(_),d(()=>e(_).other_user.name.charAt(0).toUpperCase()))]),P("click",J,()=>te(e(_))),b(Me,J)}),b(F,q)};I(v,F=>{e(g),d(()=>e(g).length===0)?F(p):F(xe,!1)},!0)}b(n,l)};I(Y,n=>{e(ee)?n(Fe):n(_e,!1)})}r(Se),r(ie);var oe=o(ie,2),m=a(oe);{var D=n=>{var l=Bt(),v=Ae(l),p=a(v),xe=a(p,!0);r(p);var F=o(p,2),q=a(F),Le=a(q,!0);r(q);var Me=o(q,2),_=a(Me,!0);r(Me),r(F),r(v);var J=o(v,2),ne=a(J);{var Te=j=>{var K=Mt();b(j,K)},De=j=>{var K=Re(),Ue=Ae(K);Ee(Ue,1,()=>e(G),Je,(Pe,Q)=>{var U=Tt(),ve=a(U),Ge=a(ve),Ve=a(Ge,!0);r(Ge);var Ze=o(Ge,2),at=a(Ze,!0);r(Ze),r(ve),r(U),O(st=>{he(U,1,`flex ${e(Q),d(()=>e(Q).is_mine?"justify-end":"justify-start")??""}`),he(ve,1,`max-w-[70%] rounded-2xl px-4 py-2 ${e(Q),d(()=>e(Q).is_mine?"bg-blue-600 text-white rounded-br-none":"bg-white border border-gray-100 text-gray-800 rounded-bl-none")??""}`),y(Ve,(e(Q),d(()=>e(Q).message_text))),y(at,st)},[()=>(e(Q),d(()=>new Date(e(Q).created_at).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})))]),b(Pe,U)}),b(j,K)};I(ne,j=>{e(G),d(()=>e(G).length===0)?j(Te):j(De,!1)})}r(J);var de=o(J,2),le=a(de),Ie=o(a(le),2),Be=a(Ie,!0);r(Ie),r(le);var i=o(le,2);{var c=j=>{yt(j,{get conversationId(){return e(t),d(()=>e(t).id)},get recipientId(){return e(t),d(()=>e(t).other_user.id)},get subjects(){return e(V)},$$events:{success:ke}})};I(i,j=>{e(H)&&j(c)})}var $=o(i,2);{var L=j=>{var K=Ct();b(j,K)},ce=j=>{var K=Re(),Ue=Ae(K);{var Pe=U=>{var ve=Nt();b(U,ve)},Q=U=>{var ve=Ft();Ee(ve,5,()=>e(R),Je,(Ge,Ve)=>{It(Ge,{get agreement(){return e(Ve)},$$events:{responded:pe,hoursLogged:je}})}),r(ve),b(U,ve)};I(Ue,U=>{e(R),d(()=>e(R).length===0)?U(Pe):U(Q,!1)},!0)}b(j,K)};I($,j=>{e(C)?j(L):j(ce,!1)})}r(de);var w=o(de,2),k=a(w),ue=a(k);Oe(ue);var ze=o(ue,2);r(k),r(w),O((j,K)=>{y(xe,j),y(Le,(e(t),d(()=>e(t).other_user.name))),y(_,(e(t),d(()=>e(t).other_user.role==="student"?"Ã–ÄŸretmen":"Veli"))),y(Be,e(H)?"Formu Gizle":"Onay Formu GÃ¶nder"),ze.disabled=K},[()=>(e(t),d(()=>e(t).other_user.name.charAt(0).toUpperCase())),()=>(e(z),e(s),d(()=>!e(z).trim()||e(s)))]),P("click",Ie,()=>u(H,!e(H))),ye(ue,()=>e(z),j=>u(z,j)),P("submit",k,bt(fe)),b(n,l)},A=n=>{var l=Gt();b(n,l)};I(m,n=>{e(t)?n(D):n(A,!1)})}r(oe),r($e),r(se),b(Ce,se),Qe(),S()}export{lr as component};
